import*as e from"jsx-dom";var t={722:(e,t,n)=>{var o;n.d(t,{L8:()=>N});var i="undefined"==typeof document?void 0:document,s=!!i&&"content"in i.createElement("template"),r=!!i&&i.createRange&&"createContextualFragment"in i.createRange();function a(e,t){var n,o,i=e.nodeName,s=t.nodeName;return i===s||(n=i.charCodeAt(0),o=s.charCodeAt(0),n<=90&&o>=97?i===s.toUpperCase():o<=90&&n>=97&&s===i.toUpperCase())}function d(e,t,n){e[n]!==t[n]&&(e[n]=t[n],e[n]?e.setAttribute(n,""):e.removeAttribute(n))}var l={OPTION:function(e,t){var n=e.parentNode;if(n){var o=n.nodeName.toUpperCase();"OPTGROUP"===o&&(o=(n=n.parentNode)&&n.nodeName.toUpperCase()),"SELECT"!==o||n.hasAttribute("multiple")||(e.hasAttribute("selected")&&!t.selected&&(e.setAttribute("selected","selected"),e.removeAttribute("selected")),n.selectedIndex=-1)}d(e,t,"selected")},INPUT:function(e,t){d(e,t,"checked"),d(e,t,"disabled"),e.value!==t.value&&(e.value=t.value),t.hasAttribute("value")||e.removeAttribute("value")},TEXTAREA:function(e,t){var n=t.value;e.value!==n&&(e.value=n);var o=e.firstChild;if(o){var i=o.nodeValue;if(i==n||!n&&i==e.placeholder)return;o.nodeValue=n}},SELECT:function(e,t){if(!t.hasAttribute("multiple")){for(var n,o,i=-1,s=0,r=e.firstChild;r;)if("OPTGROUP"===(o=r.nodeName&&r.nodeName.toUpperCase()))r=(n=r).firstChild;else{if("OPTION"===o){if(r.hasAttribute("selected")){i=s;break}s++}!(r=r.nextSibling)&&n&&(r=n.nextSibling,n=null)}e.selectedIndex=i}}};function c(){}function h(e){if(e)return e.getAttribute&&e.getAttribute("id")||e.id}const p=function(e,t,n){if(n||(n={}),"string"==typeof t)if("#document"===e.nodeName||"HTML"===e.nodeName||"BODY"===e.nodeName){var d=t;(t=i.createElement("html")).innerHTML=d}else p=(p=t).trim(),t=s?function(e){var t=i.createElement("template");return t.innerHTML=e,t.content.childNodes[0]}(p):r?function(e){return o||(o=i.createRange()).selectNode(i.body),o.createContextualFragment(e).childNodes[0]}(p):function(e){var t=i.createElement("body");return t.innerHTML=e,t.childNodes[0]}(p);else 11===t.nodeType&&(t=t.firstElementChild);var p,v=n.getNodeKey||h,u=n.onBeforeNodeAdded||c,f=n.onNodeAdded||c,_=n.onBeforeElUpdated||c,m=n.onElUpdated||c,g=n.onBeforeNodeDiscarded||c,E=n.onNodeDiscarded||c,b=n.onBeforeElChildrenUpdated||c,y=n.skipFromChildren||c,w=n.addChild||function(e,t){return e.appendChild(t)},N=!0===n.childrenOnly,A=Object.create(null),S=[];function C(e){S.push(e)}function H(e,t){if(1===e.nodeType)for(var n=e.firstChild;n;){var o=void 0;t&&(o=v(n))?C(o):(E(n),n.firstChild&&H(n,t)),n=n.nextSibling}}function R(e,t,n){!1!==g(e)&&(t&&t.removeChild(e),E(e),H(e,n))}function D(e){if(1===e.nodeType||11===e.nodeType)for(var t=e.firstChild;t;){var n=v(t);n&&(A[n]=t),D(t),t=t.nextSibling}}function T(e){f(e);for(var t=e.firstChild;t;){var n=t.nextSibling,o=v(t);if(o){var i=A[o];i&&a(t,i)?(t.parentNode.replaceChild(i,t),U(i,t)):T(t)}else T(t);t=n}}function U(e,t,n){var o=v(t);if(o&&delete A[o],!n){var s=_(e,t);if(!1===s)return;if(s instanceof HTMLElement&&D(e=s),function(e,t){var n,o,i,s,r=t.attributes;if(11!==t.nodeType&&11!==e.nodeType){for(var a=r.length-1;a>=0;a--)o=(n=r[a]).name,i=n.namespaceURI,s=n.value,i?(o=n.localName||o,e.getAttributeNS(i,o)!==s&&("xmlns"===n.prefix&&(o=n.name),e.setAttributeNS(i,o,s))):e.getAttribute(o)!==s&&e.setAttribute(o,s);for(var d=e.attributes,l=d.length-1;l>=0;l--)o=(n=d[l]).name,(i=n.namespaceURI)?(o=n.localName||o,t.hasAttributeNS(i,o)||e.removeAttributeNS(i,o)):t.hasAttribute(o)||e.removeAttribute(o)}}(e,t),m(e),!1===b(e,t))return}"TEXTAREA"!==e.nodeName?function(e,t){var n,o,s,r,d,c=y(e,t),h=t.firstChild,p=e.firstChild;e:for(;h;){for(r=h.nextSibling,n=v(h);!c&&p;){if(s=p.nextSibling,h.isSameNode&&h.isSameNode(p)){h=r,p=s;continue e}o=v(p);var f=p.nodeType,_=void 0;if(f===h.nodeType&&(1===f?(n?n!==o&&((d=A[n])?s===d?_=!1:(e.insertBefore(d,p),o?C(o):R(p,e,!0),o=v(p=d)):_=!1):o&&(_=!1),(_=!1!==_&&a(p,h))&&U(p,h)):3!==f&&8!=f||(_=!0,p.nodeValue!==h.nodeValue&&(p.nodeValue=h.nodeValue))),_){h=r,p=s;continue e}o?C(o):R(p,e,!0),p=s}if(n&&(d=A[n])&&a(d,h))c||w(e,d),U(d,h);else{var m=u(h);!1!==m&&(m&&(h=m),h.actualize&&(h=h.actualize(e.ownerDocument||i)),w(e,h),T(h))}h=r,p=s}!function(e,t,n){for(;t;){var o=t.nextSibling;(n=v(t))?C(n):R(t,e,!0),t=o}}(e,p,o);var g=l[e.nodeName];g&&g(e,t)}(e,t):l.TEXTAREA(e,t)}D(e);var x,O,L=e,P=L.nodeType,k=t.nodeType;if(!N)if(1===P)1===k?a(e,t)||(E(e),L=function(e,t){for(var n=e.firstChild;n;){var o=n.nextSibling;t.appendChild(n),n=o}return t}(e,(x=t.nodeName,(O=t.namespaceURI)&&"http://www.w3.org/1999/xhtml"!==O?i.createElementNS(O,x):i.createElement(x)))):L=t;else if(3===P||8===P){if(k===P)return L.nodeValue!==t.nodeValue&&(L.nodeValue=t.nodeValue),L;L=t}if(L===t)E(e);else{if(t.isSameNode&&t.isSameNode(L))return;if(U(L,t,N),S)for(var z=0,M=S.length;z<M;z++){var I=A[S[z]];I&&R(I,I.parentNode,!1)}}return!N&&L!==e&&e.parentNode&&(L.actualize&&(L=L.actualize(e.ownerDocument||i)),e.parentNode.replaceChild(L,e)),L},v={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let u;const f=new Uint8Array(16);function _(){if(!u){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");u=crypto.getRandomValues.bind(crypto)}return u(f)}const m=[];for(let e=0;e<256;++e)m.push((e+256).toString(16).slice(1));const g=function(e,t,n){if(v.randomUUID&&!t&&!e)return v.randomUUID();const o=(e=e||{}).random||(e.rng||_)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=o[e];return t}return function(e,t=0){return(m[e[t+0]]+m[e[t+1]]+m[e[t+2]]+m[e[t+3]]+"-"+m[e[t+4]]+m[e[t+5]]+"-"+m[e[t+6]]+m[e[t+7]]+"-"+m[e[t+8]]+m[e[t+9]]+"-"+m[e[t+10]]+m[e[t+11]]+m[e[t+12]]+m[e[t+13]]+m[e[t+14]]+m[e[t+15]]).toLowerCase()}(o)};class E extends HTMLElement{}customElements.define("reactor-viewport",E);class b{_id;_state;_render;_viewport;_container;_root;_emit=new Map;_http=new Map;_globalEvents=new Map;_localEvents=new Map;_selfEvents=new Map;_documentEvents=new Map;_debug;_resizeObserver;_resizeUserHandler;_dommode;_validation;_deferredRedraw=!1;constructor(e){this._id=g(),this._state=e.initialState,this._render="render"in e?e.render:e.display,this._viewport=document.createElement("reactor-viewport"),this._viewport.classList.add("viewport"),this._viewport.dataset.id=this._id,e.id&&(this._viewport.id=e.id),this._dommode=e.dommode||"shadow";const t="shadow"===this._dommode?this._viewport.attachShadow({mode:"closed",clonable:!0,delegatesFocus:!0}):this._viewport;if(this._container=e.container?e.container:document.createElement("div"),t.appendChild(this._container),this._root=this._render(this._state),this._container.appendChild(this._root),e.styles&&(t instanceof ShadowRoot?t.adoptedStyleSheets.push(e.styles):document.adoptedStyleSheets.push(e.styles)),this._debug=!!e.debug,this._debug&&console.log("nikonov-components: create reactor with options",e),this._globalEventHandler=this._globalEventHandler.bind(this),this._documentEventHandler=this._documentEventHandler.bind(this),this._localEventHandler=this._localEventHandler.bind(this),this._selfEventHandler=this._selfEventHandler.bind(this),this._resizeHandler=this._resizeHandler.bind(this),e.events)for(const t in e.events)if(Object.hasOwn(e.events,t)){const n=e.events[t];"function"==typeof n?this._localEvents.set(t,{handler:n}):Object.hasOwn(n,"target")&&"local"!==n.target?"self"===n.target?this._selfEvents.set(t,{handler:n.handler,options:n.options,stopPropagation:n.stopPropagation,preventDefault:n.preventDefault}):"window"===n.target?this._globalEvents.set(t,{handler:n.handler,options:n.options,stopPropagation:n.stopPropagation,preventDefault:n.preventDefault}):this._documentEvents.set(t,{handler:n.handler,options:n.options,stopPropagation:n.stopPropagation,preventDefault:n.preventDefault}):this._localEvents.set(t,{handler:n.handler,options:n.options,stopPropagation:n.stopPropagation,preventDefault:n.preventDefault})}if(e.emit)for(const t of e.emit)this._emit.set(t.when,new Set(Array.isArray(t.emit)?t.emit:[t.emit]));if(e.http)for(const t of e.http)this._http.set(t.when,new Set(Array.isArray(t.send)?t.send:[t.send]));for(const e of this._localEvents.keys())this._container.addEventListener(e,this._localEventHandler,this._localEvents.get(e).options||!0);for(const e of this._selfEvents.keys())this._viewport.addEventListener(e,this._selfEventHandler,this._selfEvents.get(e).options||!0);for(const e of this._globalEvents.keys())window.addEventListener(e,this._globalEventHandler,this._globalEvents.get(e).options||!0);for(const e of this._documentEvents.keys())this._container.ownerDocument.addEventListener(e,this._documentEventHandler,this._documentEvents.get(e).options||!0);e.onResize&&(this._resizeUserHandler=e.onResize,this._resizeObserver=new ResizeObserver(this._resizeHandler),this._resizeObserver.observe(this._viewport)),this._sendRequests(null),this._validation=e.validation,this._maybeValidate()}destructor(){for(const e of this._localEvents.keys())this._container.removeEventListener(e,this._localEventHandler,this._localEvents.get(e).options||!0);for(const e of this._selfEvents.keys())this._viewport.removeEventListener(e,this._selfEventHandler,this._selfEvents.get(e).options||!0);for(const e of this._globalEvents.keys())window.removeEventListener(e,this._globalEventHandler,this._globalEvents.get(e).options||!0);for(const e of this._documentEvents.keys())this._container.ownerDocument.removeEventListener(e,this._documentEventHandler,this._documentEvents.get(e).options||!0);this._resizeObserver&&this._resizeObserver.unobserve(this._viewport)}_maybeValidate(){if(this._validation){const[e,t]=this._validation.validate(this._state);this._validityDiffers(e)&&this._validation.internals.setValidity(e,t),this._validation.internals.setFormValue(this._validation.formValue(this._state))}}_validityDiffers(e){const t=this._validation.internals.validity;return t.valueMissing!==(e.valueMissing??!1)||t.stepMismatch!==(e.stepMismatch??!1)||t.badInput!==(e.badInput??!1)||t.customError!==(e.customError??!1)||t.patternMismatch!==(e.patternMismatch??!1)||t.rangeOverflow!==(e.rangeOverflow??!1)||t.rangeUnderflow!==(e.rangeUnderflow??!1)||t.tooLong!==(e.tooLong??!1)||t.tooShort!==(e.tooShort??!1)||t.typeMismatch!==(e.typeMismatch??!1)}_resizeHandler(e){this._changeState(this._resizeUserHandler(this._state,e))}_handleResult(e){if(Array.isArray(e)&&2===e.length&&(e[1]instanceof Event||Array.isArray(e[1])&&e[1][0]instanceof Event)){this._changeState(e[0]);const t=e[1]instanceof Event?[e[1]]:e[1];for(const e of t)this._dispatchEvent(e)}else this._changeState(e)}_handleEvent(e,t){const n=t(this._state,e);this._handleResult(n)}_localEventHandler(e){this._debug&&console.log("nikonov-components: local event catch",e);const t=this._localEvents.get(e.type);(t.preventDefault||["submit"].includes(e.type)&&!1!==t.preventDefault)&&e.preventDefault(),!1!==t.stopPropagation&&e.stopImmediatePropagation(),this._handleEvent(e,t.handler)}_selfEventHandler(e){this._debug&&console.log("nikonov-components: self event catch",e);const t=this._selfEvents.get(e.type);(t.preventDefault||["submit"].includes(e.type)&&!1!==t.preventDefault)&&e.preventDefault(),!1!==t.stopPropagation&&e.stopImmediatePropagation(),this._handleEvent(e,t.handler)}_globalEventHandler(e){this._debug&&console.log("nikonov-components: global event catch",e);const t=this._globalEvents.get(e.type);t.preventDefault&&e.preventDefault(),!1!==t.stopPropagation&&e.stopImmediatePropagation(),this._handleEvent(e,t.handler)}_documentEventHandler(e){this._debug&&console.log("nikonov-components: document event catch",e);const t=this._documentEvents.get(e.type);t.preventDefault&&e.preventDefault(),!1!==t.stopPropagation&&e.stopImmediatePropagation(),this._handleEvent(e,t.handler)}_redraw(){const e=this._render(this._state);this._debug&&console.log("nikonov-components: redraw",this._root.cloneNode(!0),e.cloneNode(!0)),this._root.isEqualNode(e)||(this._root.nodeName!==e.nodeName?(this._root.replaceWith(e),this._root=e):p(this._root,e,{getNodeKey:e=>e instanceof E?e.dataset.id:e.id,onBeforeNodeAdded:e=>(this._debug&&console.log("nikonov-components: element added",e.cloneNode(!0)),e instanceof E&&e.classList.contains("stub")?e.reference.deref():e),onBeforeElUpdated:(e,t)=>(this._debug&&console.log("nikonov-components: element update",e.cloneNode(!0),t.cloneNode(!0)),!e.isEqualNode(t)&&(t instanceof E?t.dataset.id!==e.dataset.id&&(t.classList.contains("viewport")?t:(e.replaceWith(t.reference.deref()),!1)):e))}))}_dispatchEvent(e){this._viewport.isConnected?this._viewport.dispatchEvent(e):window.dispatchEvent(e)}_emitEvents(e){for(let[t,n]of this._emit)if(t(e,this._state))for(let t of n)this._dispatchEvent(t(this._state,e))}async _sendRequest(e){const t=("function"==typeof e?e:e.request)(this._state),n="retry"in e&&e.retry?e.retry:1;let o=null;for(let i=0;i<n;i++)try{o=await fetch(t);break}catch(t){if(i<n-1)continue;return void("error"in e&&e.error&&this._handleResult(e.error(this._state,t)))}if("response"in e&&e.response||"error"in e&&e.error){let t="";try{if(!o.ok)throw new Error(o.statusText);t=await o.text()}catch(t){return void("error"in e&&e.error&&this._handleResult(e.error(this._state,t)))}"response"in e&&e.response&&this._handleResult(e.response(this._state,o,t))}}_sendRequests(e){for(let[t,n]of this._http)t(e,this._state)&&n.forEach((e=>{this._sendRequest(e)}))}_changeState(e){if(this._state===e)return;const t=this._state;this._state=e,this._deferredRedraw||(setTimeout((()=>{this._redraw(),this._deferredRedraw=!1}),0),this._deferredRedraw=!0),this._emitEvents(t),this._sendRequests(t),this._maybeValidate(),this._debug&&console.log("nikonov-components: transition from",t,"to",this._state)}}const y=new FinalizationRegistry((e=>{e._debug&&console.log("nikonov-components gc:",e._id,JSON.parse(JSON.stringify(e._state))),e.destructor()}));class w{_core;constructor(e){this._core=new b(e),this._core._viewport._reactor=this,y.register(this,this._core)}}const N=e=>new w(e)}},n={};function o(e){var i=n[e];if(void 0!==i)return i.exports;var s=n[e]={exports:{}};return t[e](s,s.exports,o),s.exports}o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var i={};o.d(i,{L:()=>c});const s=(r={jsx:()=>e.jsx},a={},o.d(a,r),a);var r,a,d=o(722);const l=e=>"string"==typeof e?(0,s.jsx)("span",{children:e}):e,c=(e,t)=>d.L8({initialState:e,display:l,...t});var h=i.L;export{h as make};