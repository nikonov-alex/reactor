var e,t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},n={};t.d(n,{L8:()=>H,v7:()=>G,ni:()=>F,wk:()=>_,R9:()=>q});var r="undefined"==typeof document?void 0:document,o=!!r&&"content"in r.createElement("template"),a=!!r&&r.createRange&&"createContextualFragment"in r.createRange();function i(e,t){var n,r,o=e.nodeName,a=t.nodeName;return o===a||(n=o.charCodeAt(0),r=a.charCodeAt(0),n<=90&&r>=97?o===a.toUpperCase():r<=90&&n>=97&&a===o.toUpperCase())}function d(e,t,n){e[n]!==t[n]&&(e[n]=t[n],e[n]?e.setAttribute(n,""):e.removeAttribute(n))}var l={OPTION:function(e,t){var n=e.parentNode;if(n){var r=n.nodeName.toUpperCase();"OPTGROUP"===r&&(r=(n=n.parentNode)&&n.nodeName.toUpperCase()),"SELECT"!==r||n.hasAttribute("multiple")||(e.hasAttribute("selected")&&!t.selected&&(e.setAttribute("selected","selected"),e.removeAttribute("selected")),n.selectedIndex=-1)}d(e,t,"selected")},INPUT:function(e,t){d(e,t,"checked"),d(e,t,"disabled"),e.value!==t.value&&(e.value=t.value),t.hasAttribute("value")||e.removeAttribute("value")},TEXTAREA:function(e,t){var n=t.value;e.value!==n&&(e.value=n);var r=e.firstChild;if(r){var o=r.nodeValue;if(o==n||!n&&o==e.placeholder)return;r.nodeValue=n}},SELECT:function(e,t){if(!t.hasAttribute("multiple")){for(var n,r,o=-1,a=0,i=e.firstChild;i;)if("OPTGROUP"===(r=i.nodeName&&i.nodeName.toUpperCase()))i=(n=i).firstChild;else{if("OPTION"===r){if(i.hasAttribute("selected")){o=a;break}a++}!(i=i.nextSibling)&&n&&(i=n.nextSibling,n=null)}e.selectedIndex=o}}};function s(){}function c(e){if(e)return e.getAttribute&&e.getAttribute("id")||e.id}var u=function(t,n,d){if(d||(d={}),"string"==typeof n)if("#document"===t.nodeName||"HTML"===t.nodeName||"BODY"===t.nodeName){var u=n;(n=r.createElement("html")).innerHTML=u}else f=(f=n).trim(),n=o?function(e){var t=r.createElement("template");return t.innerHTML=e,t.content.childNodes[0]}(f):a?function(t){return e||(e=r.createRange()).selectNode(r.body),e.createContextualFragment(t).childNodes[0]}(f):function(e){var t=r.createElement("body");return t.innerHTML=e,t.childNodes[0]}(f);else 11===n.nodeType&&(n=n.firstElementChild);var f,v=d.getNodeKey||c,p=d.onBeforeNodeAdded||s,m=d.onNodeAdded||s,h=d.onBeforeElUpdated||s,b=d.onElUpdated||s,N=d.onBeforeNodeDiscarded||s,w=d.onNodeDiscarded||s,y=d.onBeforeElChildrenUpdated||s,E=d.skipFromChildren||s,g=d.addChild||function(e,t){return e.appendChild(t)},A=!0===d.childrenOnly,T=Object.create(null),C=[];function S(e){C.push(e)}function L(e,t){if(1===e.nodeType)for(var n=e.firstChild;n;){var r=void 0;t&&(r=v(n))?S(r):(w(n),n.firstChild&&L(n,t)),n=n.nextSibling}}function O(e,t,n){!1!==N(e)&&(t&&t.removeChild(e),w(e),L(e,n))}function R(e){if(1===e.nodeType||11===e.nodeType)for(var t=e.firstChild;t;){var n=v(t);n&&(T[n]=t),R(t),t=t.nextSibling}}function x(e){m(e);for(var t=e.firstChild;t;){var n=t.nextSibling,r=v(t);if(r){var o=T[r];o&&i(t,o)?(t.parentNode.replaceChild(o,t),P(o,t)):x(t)}else x(t);t=n}}function P(e,t,n){var o=v(t);if(o&&delete T[o],!n){var a=h(e,t);if(!1===a)return;if(a instanceof HTMLElement&&R(e=a),function(e,t){var n,r,o,a,i=t.attributes;if(11!==t.nodeType&&11!==e.nodeType){for(var d=i.length-1;d>=0;d--)r=(n=i[d]).name,o=n.namespaceURI,a=n.value,o?(r=n.localName||r,e.getAttributeNS(o,r)!==a&&("xmlns"===n.prefix&&(r=n.name),e.setAttributeNS(o,r,a))):e.getAttribute(r)!==a&&e.setAttribute(r,a);for(var l=e.attributes,s=l.length-1;s>=0;s--)r=(n=l[s]).name,(o=n.namespaceURI)?(r=n.localName||r,t.hasAttributeNS(o,r)||e.removeAttributeNS(o,r)):t.hasAttribute(r)||e.removeAttribute(r)}}(e,t),b(e),!1===y(e,t))return}"TEXTAREA"!==e.nodeName?function(e,t){var n,o,a,d,s,c=E(e,t),u=t.firstChild,f=e.firstChild;e:for(;u;){for(d=u.nextSibling,n=v(u);!c&&f;){if(a=f.nextSibling,u.isSameNode&&u.isSameNode(f)){u=d,f=a;continue e}o=v(f);var m=f.nodeType,h=void 0;if(m===u.nodeType&&(1===m?(n?n!==o&&((s=T[n])?a===s?h=!1:(e.insertBefore(s,f),o?S(o):O(f,e,!0),o=v(f=s)):h=!1):o&&(h=!1),(h=!1!==h&&i(f,u))&&P(f,u)):3!==m&&8!=m||(h=!0,f.nodeValue!==u.nodeValue&&(f.nodeValue=u.nodeValue))),h){u=d,f=a;continue e}o?S(o):O(f,e,!0),f=a}if(n&&(s=T[n])&&i(s,u))c||g(e,s),P(s,u);else{var b=p(u);!1!==b&&(b&&(u=b),u.actualize&&(u=u.actualize(e.ownerDocument||r)),g(e,u),x(u))}u=d,f=a}!function(e,t,n){for(;t;){var r=t.nextSibling;(n=v(t))?S(n):O(t,e,!0),t=r}}(e,f,o);var N=l[e.nodeName];N&&N(e,t)}(e,t):l.TEXTAREA(e,t)}R(t);var U,M,I=t,V=I.nodeType,j=n.nodeType;if(!A)if(1===V)1===j?i(t,n)||(w(t),I=function(e,t){for(var n=e.firstChild;n;){var r=n.nextSibling;t.appendChild(n),n=r}return t}(t,(U=n.nodeName,(M=n.namespaceURI)&&"http://www.w3.org/1999/xhtml"!==M?r.createElementNS(M,U):r.createElement(U)))):I=n;else if(3===V||8===V){if(j===V)return I.nodeValue!==n.nodeValue&&(I.nodeValue=n.nodeValue),I;I=n}if(I===n)w(t);else{if(n.isSameNode&&n.isSameNode(I))return;if(P(I,n,A),C)for(var k=0,B=C.length;k<B;k++){var D=T[C[k]];D&&O(D,D.parentNode,!1)}}return!A&&I!==t&&t.parentNode&&(I.actualize&&(I=I.actualize(t.ownerDocument||r)),t.parentNode.replaceChild(I,t)),I};const f=u;var v={d:(e,t)=>{for(var n in t)v.o(t,n)&&!v.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},p={};v.d(p,{qM:()=>w,E1:()=>N,_u:()=>m,_w:()=>h,Er:()=>b});var m={};v.r(m),v.d(m,{EMPTY_LIST:()=>y,concat:()=>L,cons:()=>E,count:()=>P,filter:()=>S,find:()=>x,fold:()=>T,isEmpty:()=>g,list:()=>A,map:()=>C,prepend:()=>O,reverse:()=>R});var h={};v.r(h),v.d(h,{apply:()=>U,ifNotError:()=>I,ifNotFalse:()=>M});var b={};v.r(b);var N={};v.r(N),v.d(N,{array:()=>V});var w={};v.r(w),v.d(w,{local:()=>j});const y=null,E=(e,t)=>({first:e,rest:t}),g=e=>y===e,A=(...e)=>e.reduce(((e,t)=>E(t,e)),y),T=(e,t,n)=>g(e)?n:t(e.first,T(e.rest,t,n)),C=(e,t)=>T(e,((e,n)=>E(t(e),n)),y),S=(e,t)=>T(e,((e,n)=>t(e)?E(e,n):n),y),L=(e,t)=>T(e,E,t),O=(e,t)=>L(e,A(t)),R=e=>T(e,((e,t)=>O(t,e)),y),x=(e,t)=>!g(e)&&(t(e.first)?e.first:x(e.rest,t)),P=e=>g(e)?0:P(e.rest)+1,U=e=>(t,n)=>e(t)?t:n(t),M=U((e=>!1===e)),I=U((e=>e instanceof Error)),V=(e,t)=>Array.apply(null,Array(e)).map(((e,n)=>t(n))),j=(e,t)=>t(e);var k=p.qM;const{local:B}=k;class D extends HTMLElement{}customElements.define("reactor-viewport",D);const H=e=>B({state:e.initialState,root:e.render(e.initialState)},(t=>B((n=>{if(t.state!==n){t.state=n;const r=e.render(t.state);t.root.isEqualNode(r)||(t.root.nodeName!==r.nodeName?(t.root.replaceWith(r),t.root=r):f(t.root,r,{getNodeKey:e=>e instanceof D?e.reactor:e.id,onBeforeNodeAdded:e=>e instanceof D&&e.classList.contains("stub")?e.reference.deref():e,onBeforeElUpdated:(e,t)=>!e.isEqualNode(t)&&(!(t instanceof D)||(t.classList.contains("viewport")?t:t.reference.deref()))}))}}),(n=>B(document.createElement("reactor-viewport"),(r=>((e,t)=>(e.shadowRoot.appendChild(e.data.root),t.styles&&e.shadowRoot.adoptedStyleSheets.push(t.styles),e))({data:t,id:Symbol("id"),viewport:r,shadowRoot:r.attachShadow({mode:"open"}),events:e.events,localListener:r=>{["submit"].includes(r.type)&&r.preventDefault(),r.stopImmediatePropagation();const o=e.events.local[r.type];n(o(t.state,r))},windowListener:r=>{const o=e.events.window[r.type];n(o(t.state,r))},documentListener:r=>{const o=e.events.document[r.type];n(o(t.state,r))},running:!1},e))))))),_=e=>e.data.state,q=e=>{if(!e.viewport.isConnected)return e.viewport.classList.add("viewport"),e.viewport.reactor=e.id,e.viewport;const t=document.createElement("reactor-viewport");return t.classList.add("stub"),t.reactor=e.id,t.reference=new WeakRef(e.viewport),t},z=(e,t,n)=>Object.keys(e).forEach((e=>t.addEventListener(e,n))),F=e=>(z(e.events?.local??{},e.shadowRoot,e.localListener),z(e.events?.window??{},window,e.windowListener),z(e.events?.document??{},document,e.documentListener),{...e,running:!0}),X=(e,t,n)=>Object.keys(e).forEach((e=>t.removeEventListener(e,n))),G=e=>(X(e.events?.local??{},e.shadowRoot,e.localListener),X(e.events?.window??{},window,e.windowListener),X(e.events?.document??{},document,e.documentListener),{...e,running:!1});var K=n.L8,W=n.v7,Y=n.ni,J=n.wk,Q=n.R9;export{K as make,W as pause,Y as start,J as state,Q as viewport};